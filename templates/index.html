<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üçΩÔ∏è Quibe da Dona Ana - Fa√ßa seu pedido</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fff8f5;
      margin: 0;
      padding: 0;
    }

    .fita-comentarios {
      background-color: #8b0000;
      color: white;
      padding: 10px 0;
      overflow: hidden;
      white-space: nowrap;
      font-weight: 600;
    }

    .fita-comentarios marquee {
      font-size: 16px;
    }

    header {
      background-color: #8b0000;
      color: white;
      padding: 20px;
      text-align: center;
    }

    header h1 {
      font-size: 36px;
      margin: 0;
    }

    .menu-opcoes {
      display: flex;
      justify-content: center;
      gap: 30px;
      background-color: #fbeaea;
      padding: 12px 0;
      font-weight: bold;
    }

    .menu-opcoes a {
      color: #8b0000;
      text-decoration: none;
      font-size: 16px;
      padding: 6px 12px;
      border-radius: 4px;
    }

    .menu-opcoes a:hover {
      background-color: #f5d0d0;
    }

    .aviso {
      max-width: 500px;
      margin: 20px auto;
      background-color: #ffecb3;
      border-left: 6px solid #ffb300;
      padding: 12px;
      font-weight: 600;
      color: #665500;
      border-radius: 5px;
      text-align: center;
    }

    form {
      max-width: 520px;
      margin: 0 auto 30px;
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
      color: #333;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }

    input[type=number] {
      max-width: 80px;
    }

    button {
      margin-top: 25px;
      width: 100%;
      padding: 14px;
      background-color: #25d366;
      border: none;
      color: white;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #1bb954;
    }

    #total {
      margin-top: 10px;
      font-size: 20px;
      font-weight: bold;
      color: #1e7e34;
    }

    .avaliacao-servico, .comentarios {
      max-width: 520px;
      margin: 0 auto 30px;
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }

    .comentarios {
      background: #fff3e0;
      border-left: 5px solid #ffa000;
    }

    .comentarios ul {
      list-style: none;
      padding-left: 0;
    }

    .comentarios li {
      background: white;
      padding: 10px;
      border-left: 5px solid #ff9800;
      margin-bottom: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

{% if avaliacoes %}
<div class="fita-comentarios">
  <marquee scrollamount="6">
    {% for a in avaliacoes %}
      {{ a.nome or "An√¥nimo" }}: "{{ a.comentario }}" &nbsp;&nbsp;&nbsp;&nbsp;
    {% endfor %}
  </marquee>
</div>
{% endif %}

<header>
  <h1>üçΩÔ∏è Quibe da Dona Ana</h1>
</header>

<div class="menu-opcoes">
  <a href="#pedido">Pedido</a>
  <a href="#avaliacao">Avalia√ß√£o</a>
  <a href="#geral">Avalia√ß√£o Geral</a>
</div>

<div class="aviso">
  üöß Aten√ß√£o: Abertura em breve! Fa√ßa seu pedido e aguarde novidades. üöß
</div>

<form id="pedido" action="/enviar_pedido" method="post">
  <label for="nome">Nome</label>
  <input type="text" id="nome" name="nome" required />

  <label for="telefone">Telefone</label>
  <input type="text" id="telefone" name="telefone" required />

  <label for="cep">CEP</label>
  <input type="text" id="cep" name="cep" maxlength="9" required onblur="buscarEndereco()" placeholder="Ex: 01001-000" />

  <label for="endereco">Endere√ßo</label>
  <input type="text" id="endereco" name="endereco" required />
  
  <label for="numero">N√∫mero</label>
  <input type="text" id="numero" name="numero" required />

  <label for="pagamento">Forma de pagamento</label>
  <select id="pagamento" name="pagamento" required>
    <option value="">Selecione</option>
    <option value="Pix">Pix</option>
    <option value="Dinheiro">Dinheiro</option>
    <option value="Cart√£o">Cart√£o</option>
  </select>

  <h3 style="margin-top: 25px; color: #8b0000;">üçΩÔ∏è Produtos</h3>
  {% for produto in produtos %}
    <label>{{ produto.nome }} (R$ {{ "%.2f"|format(produto.preco) }})</label>
    <input 
      type="number" 
      name="{{ produto.nome }}" 
      min="0" 
      value="0" 
      data-preco="{{ produto.preco }}" 
      onchange="atualizarTotal()" 
      oninput="atualizarTotal()" 
    />
  {% endfor %}

  <label for="obs">Observa√ß√µes</label>
  <textarea id="obs" name="obs" placeholder="Sem pimenta, vegano, ponto da carne..."></textarea>

  <label>Total estimado:</label>
  <div id="total">R$ 0,00</div>

  <button type="submit">Enviar Pedido</button>
</form>

<div class="avaliacao-servico" id="avaliacao">
  <form action="/avaliar_servico" method="post">
    <h3 style="color: #8b0000; margin-top: 0;">‚≠ê Avalia√ß√£o do Atendimento</h3>
    <label for="nome_avaliador">Nome</label>
    <input type="text" id="nome_avaliador" name="nome_avaliador" required />

    <label for="estrela_servico">Nota (1 a 5 estrelas)</label>
    <select id="estrela_servico" name="estrela_servico" required>
      <option value="">Selecione</option>
      <option value="1">‚≠ê</option>
      <option value="2">‚≠ê‚≠ê</option>
      <option value="3">‚≠ê‚≠ê‚≠ê</option>
      <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
      <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
    </select>

    <label for="comentario_servico">Coment√°rio sobre o atendimento</label>
    <textarea id="comentario_servico" name="comentario_servico" placeholder="Sua opini√£o sobre nosso atendimento..." required></textarea>

    <button type="submit">Enviar Avalia√ß√£o</button>
  </form>
</div>

{% if avaliacoes %}
  {% set total = avaliacoes|length %}
  {% set soma = avaliacoes | map(attribute='estrela') | sum %}
  {% set media = (soma / total) if total > 0 else 0 %}
  <div class="comentarios" id="geral">
    <h3 style="margin-top: 0;">üìä Avalia√ß√£o Geral</h3>
    <p><strong>M√©dia:</strong> {{ "%.1f"|format(media) }} / 5.0 ({{ ((media / 5) * 100)|round(0) }}%)</p>
    <ul>
      {% for a in avaliacoes %}
        <li>
          <strong>{{ a.nome or "An√¥nimo" }}</strong><br>
          <strong>‚≠ê {{ a.estrela }}</strong><br>
          {{ a.comentario }}
        </li>
      {% endfor %}
    </ul>
  </div>
{% endif %}

<script>
  function buscarEndereco() {
    const cep = document.getElementById('cep').value.replace(/\D/g, '');
    if (cep.length !== 8) return;

    fetch(`https://viacep.com.br/ws/${cep}/json/`)
      .then(res => res.json())
      .then(dados => {
        if (!dados.erro) {
          const endereco = `${dados.logradouro}, ${dados.bairro}, ${dados.localidade} - ${dados.uf}`;
          document.getElementById('endereco').value = endereco;
        } else {
          alert("CEP n√£o encontrado.");
        }
      })
      .catch(() => alert("Erro ao buscar endere√ßo."));
  }

  function atualizarTotal() {
    let total = 0;
    const inputs = document.querySelectorAll('input[type="number"][data-preco]');
    inputs.forEach(input => {
      const preco = parseFloat(input.dataset.preco);
      const qtd = parseInt(input.value) || 0;
      total += preco * qtd;
    });
    document.getElementById('total').innerText = 'R$ ' + total.toFixed(2).replace('.', ',');
  }
</script>

</body>
</html>
